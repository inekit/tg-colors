"use strict";(self["webpackChunk_coreui_coreui_free_vue_admin_template"]=self["webpackChunk_coreui_coreui_free_vue_admin_template"]||[]).push([[56],{8056:function(t,e,i){i.r(e),i.d(e,{default:function(){return st}});var a=i(3396);function o(t,e,i,o,s,n){const l=(0,a.up)("AddItemModal"),r=(0,a.up)("ChangePricesModal"),d=(0,a.up)("CFormInput"),c=(0,a.up)("Table");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a.Wm)(l,{visible:s.formVisible,formData:s.formData,mode:t.formMode},null,8,["visible","formData","mode"]),(0,a.Wm)(r,{visible:s.changePricesVisible},null,8,["visible"]),(0,a.Wm)(d,{class:"mb-4",type:"text",onInput:n.search,placeholder:"Поиск по названию"},null,8,["onInput"]),(0,a.Wm)(c,{fields:s.tableFieldNames,postData:n.get,actions:s.dataActions,rows:s.rows,editMode:"form",name:"Позиции"},null,8,["fields","postData","actions","rows"])])}var s=i(9242),n=i(7139);const l=t=>((0,a.dD)("data-v-29dd553e"),t=t(),(0,a.Cn)(),t),r={class:"projects-list"},d=l((()=>(0,a._)("span",null,"Категория",-1))),c={class:"options-shedle"},p=l((()=>(0,a._)("span",null,"Опции",-1))),m={class:"types-list"},h={class:"table"},_=l((()=>(0,a._)("td",null,[(0,a.Uk)("Размер"),(0,a._)("br"),(0,a.Uk)(" Материал")],-1))),u=l((()=>(0,a._)("td",null,null,-1))),b={class:"options-shedle"},f=l((()=>(0,a._)("span",null,"Обратная сторона",-1))),g={class:"table"},y=l((()=>(0,a._)("td",null,[(0,a.Uk)("Размер"),(0,a._)("br"),(0,a.Uk)(" Материал")],-1))),w={class:"border p-2 mt-3 preview-container"},k=["src"],j=["onClick"];function D(t,e,i,o,l,D){const v=(0,a.up)("CButton"),C=(0,a.up)("CModalTitle"),z=(0,a.up)("CModalHeader"),M=(0,a.up)("CFormInput"),$=(0,a.up)("CFormCheck"),W=(0,a.up)("CInputGroup"),P=(0,a.up)("QuillEditor"),V=(0,a.up)("CModalBody"),U=(0,a.up)("CModalFooter"),O=(0,a.up)("CForm"),Z=(0,a.up)("CModal");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(v,{color:"primary",onClick:D.addNewPost},{default:(0,a.w5)((()=>[(0,a.Uk)("Добавить товар")])),_:1},8,["onClick"]),(0,a.Wm)(Z,{size:"xl",backdrop:"static",alignment:"center",visible:i.visible,onClose:D.closeModal},{default:(0,a.w5)((()=>[(0,a.Wm)(O,{novalidate:"",validated:l.formValid,ref:"add-file-form",onChange:t.wregert,onSubmit:e[7]||(e[7]=(0,s.iM)((t=>"new"===i.mode?D.addNewing():D.editNewing()),["prevent"])),class:"add-user",style:{display:"'none'"}},{default:(0,a.w5)((()=>[(0,a.Wm)(z,null,{default:(0,a.w5)((()=>[(0,a.Wm)(C,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)("new"===i.mode?"Добавить товар":"Редактировать товар"),1)])),_:1})])),_:1}),(0,a.Wm)(V,null,{default:(0,a.w5)((()=>[(0,a.Wm)(M,{class:"mb-3",modelValue:i.formData.title,"onUpdate:modelValue":e[0]||(e[0]=t=>i.formData.title=t),placeholder:"Заголовок",id:"inputHeader","aria-describedby":"inputGroupPrepend",feedbackValid:"Все ок",feedbackInvalid:"Введите корректный заголовок",required:""},null,8,["modelValue"]),(0,a._)("div",r,[d,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.projects,(t=>((0,a.wg)(),(0,a.j4)($,{key:t.name,id:t.name,checked:t.name===i.formData.category_name,onChange:D.changeP,type:"radio",name:"project-name",value:t.name,label:t.name},null,8,["id","checked","onChange","value","label"])))),128)),(0,a.Wm)($,{id:"null-name",checked:!i.formData.category_name,onChange:D.changeP,type:"radio",name:"project-name",value:"",label:"Без категорий"},null,8,["checked","onChange"])]),(0,a._)("div",c,[p,(0,a._)("div",m,[(0,a.Wm)($,{id:"changeall",checked:!0===l.editAll,onInput:e[1]||(e[1]=t=>l.editAll=!0),type:"radio",name:"changeall",value:"changeall",label:"Изменить все в категории"},null,8,["checked"]),(0,a.Wm)($,{id:"changeonly",checked:!1===l.editAll,onInput:e[2]||(e[2]=t=>l.editAll=!1),type:"radio",name:"changeonly",value:"changeonly",label:"Изменить только для данного товара"},null,8,["checked"])]),(0,a._)("table",h,[(0,a._)("thead",null,[(0,a._)("tr",null,[_,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(l.distinct_sizes,(t=>((0,a.wg)(),(0,a.iD)("td",{key:"sizeh-"+t},[(0,a.Uk)((0,n.zw)(t)+" ",1),(0,a.Wm)(v,{color:"secondary",onClick:e=>D.dropSize(t)},{default:(0,a.w5)((()=>[(0,a.Uk)("X")])),_:2},1032,["onClick"])])))),128)),(0,a._)("td",null,[(0,a.Wm)(W,{class:""},{default:(0,a.w5)((()=>[(0,a.Wm)(M,{placeholder:"Новый размер",type:"text",modelValue:l.tempSize,"onUpdate:modelValue":e[3]||(e[3]=t=>l.tempSize=t)},null,8,["modelValue"]),(0,a.Wm)(v,{class:"add-button",type:"button",color:"secondary",onClick:e[4]||(e[4]=t=>D.addSize(l.tempSize)),variant:"outline"},{default:(0,a.w5)((()=>[(0,a.Uk)("Добавить")])),_:1})])),_:1})])])]),(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(l.distinct_materials,(t=>((0,a.wg)(),(0,a.iD)("tr",{key:"material-"+t},[(0,a._)("td",null,[(0,a.Uk)((0,n.zw)(t)+" ",1),(0,a.Wm)(v,{color:"secondary",onClick:e=>D.dropMaterial(t)},{default:(0,a.w5)((()=>[(0,a.Uk)("X")])),_:2},1032,["onClick"])]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(l.distinct_sizes,(e=>((0,a.wg)(),(0,a.iD)("td",{key:"size-"+e},[(0,a.Wm)(M,{type:"number",modelValue:l.options_object[t][e],"onUpdate:modelValue":i=>l.options_object[t][e]=i,modelModifiers:{number:!0}},null,8,["modelValue","onUpdate:modelValue"])])))),128)),u])))),128)),(0,a._)("tr",null,[(0,a._)("td",null,[(0,a.Wm)(W,{class:""},{default:(0,a.w5)((()=>[(0,a.Wm)(M,{placeholder:"Новый материал",type:"text",modelValue:l.tempMaterial,"onUpdate:modelValue":e[5]||(e[5]=t=>l.tempMaterial=t)},null,8,["modelValue"]),(0,a.Wm)(v,{class:"add-button",type:"button",color:"secondary",onClick:e[6]||(e[6]=t=>D.addMaterial(l.tempMaterial)),variant:"outline"},{default:(0,a.w5)((()=>[(0,a.Uk)("Добавить ")])),_:1})])),_:1})])])])])]),(0,a._)("div",b,[f,(0,a._)("table",g,[(0,a._)("thead",null,[(0,a._)("tr",null,[y,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(l.distinct_sizes,(t=>((0,a.wg)(),(0,a.iD)("td",{key:"sizeh-"+t},(0,n.zw)(t),1)))),128))])]),(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(l.distinct_materials,(t=>((0,a.wg)(),(0,a.iD)("tr",{key:"material-"+t},[(0,a._)("td",null,(0,n.zw)(t),1),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(l.distinct_sizes,(e=>((0,a.wg)(),(0,a.iD)("td",{key:"size-"+e},[(0,a.Wm)(M,{type:"number",modelValue:l.options_object_backside[t][e],"onUpdate:modelValue":i=>l.options_object_backside[t][e]=i,modelModifiers:{number:!0}},null,8,["modelValue","onUpdate:modelValue"])])))),128))])))),128))])])]),(0,a.Wm)(M,{type:"file",accept:"image/*",multiple:"multiple",ref:"file",onChange:D.previewMultiImage,class:"mb-3",label:"Превью",placeholder:"Превью"},null,8,["onChange"]),(0,a._)("div",w,[l.preview_list?.length?((0,a.wg)(!0),(0,a.iD)(a.HY,{key:0},(0,a.Ko)(l.preview_list,((t,e)=>((0,a.wg)(),(0,a.iD)("div",{key:e},[(0,a._)("img",{src:t,class:"img-fluid"},null,8,k),(0,a._)("button",{onClick:(0,s.iM)((t=>D.dropFile(e)),["prevent"])},"Х",8,j)])))),128)):(0,a.kq)("",!0)]),(0,a.Wm)(P,{theme:"snow",toolbar:"essential",ref:"postTextEditor",id:"postTextEditor",placeholder:"Краткое описание"},null,512)])),_:1}),(0,a.Wm)(U,null,{default:(0,a.w5)((()=>[(0,a.Wm)(v,{color:"secondary",onClick:D.closeModal},{default:(0,a.w5)((()=>[(0,a.Uk)(" Отменить ")])),_:1},8,["onClick"]),(0,a.wy)((0,a.Wm)(v,{color:"primary",type:"submit"},{default:(0,a.w5)((()=>[(0,a.Uk)("Добавить")])),_:1},512),[[s.F8,"new"===i.mode]]),(0,a.wy)((0,a.Wm)(v,{color:"primary",type:"submit"},{default:(0,a.w5)((()=>[(0,a.Uk)("Редактировать")])),_:1},512),[[s.F8,"edit"===i.mode]])])),_:1})])),_:1},8,["validated","onChange"])])),_:1},8,["visible","onClose"])],64)}i(7658);var v=i(6265),C=i.n(v),z=i(6149),M=i(2777),$=i(5068),W=i(7123);const P=C().create({withCredentials:!0});var V={components:{QuillEditor:z.Bn},props:{mode:{required:!0,type:String,validator:t=>["new","edit"].includes(t.toLowerCase())},visible:!1,formData:{title:"",text:"",description:"",preview:"",category_name:"",image_list:[],tags_array:new Set,options_object:{},options_array:[]}},data(){return{textMd2:"",textEditMode:"md2",formValid:!1,preview_list:[],options_object:{},options_object_backside:{},distinct_materials:[],distinct_sizes:[],tempSize:0,tempMaterial:0,editAll:!1}},updated(){console.log(1),this.options_object={},this.editAll=!1,this.options_object_backside={},this.formData.options_array=this.formData.options_array?.filter((({material:t,price:e,size:i})=>!!(t||i||e))),this.distinct_materials=[...new Set(this.formData.options_array?.map((({material:t})=>t)))],this.distinct_sizes=[...new Set(this.formData.options_array?.map((({size:t})=>t)))],this.formData.description&&this.$refs.postTextEditor.pasteHTML($.TU.parse(this.formData.description?.replaceAll("\r\n\r\n","<span><br/><span/>\r\n\r\n")));for(let{size:t,material:e,price:i,is_backside:a}of this.formData.options_array)a?(this.options_object_backside[e]?this.options_object_backside[e][t]=i:this.options_object_backside[e]={[t]:i},this.options_object[e]?this.options_object[e][t]=this.options_object[e][t]??null:this.options_object[e]={[t]:null}):(this.options_object[e]?this.options_object[e][t]=i:this.options_object[e]={[t]:i},this.options_object_backside[e]?this.options_object_backside[e][t]=this.options_object_backside[e][t]??null:this.options_object_backside[e]={[t]:null});console.log(this.options_object,this.options_object_backside),this.preview_list=this.formData.image_list?.filter((t=>t))?.map((t=>`${this.$store.state.serverAddr}/pics/${t}`)),document.getElementsByClassName("ql-toolbar")?.[0]?.classList.add("hidden")},async mounted(){this.projects=await this.getProjects(),console.log(this.tags,this.projects)},methods:{addMaterial(t){let e=Object.values(this.options_object)?.[0]??{};e=Object.fromEntries(Object.entries(e)?.map((([t])=>[t,0]))),this.options_object[t]=e,e=Object.values(this.options_object_backside)?.[0]??{},e=Object.fromEntries(Object.entries(e)?.map((([t])=>[t,0]))),this.options_object_backside[t]=e,this.distinct_materials.push(t),this.tempMaterial=""},addSize(t){const e=Object.entries(this.options_object)?.map((([e,i])=>[e,Object.assign(i??{},{[t]:0})]));this.options_object=Object.fromEntries(e);const i=Object.entries(this.options_object_backside)?.map((([e,i])=>[e,Object.assign(i??{},{[t]:0})]));this.options_object_backside=Object.fromEntries(i),this.tempSize="",this.distinct_sizes.push(t)},dropMaterial(t){delete this.options_object[t],delete this.options_object_backside[t],this.distinct_materials=this.distinct_materials?.filter((e=>e!==t))},dropSize(t){for(let e in this.options_object)delete this.options_object[e][t],delete this.options_object_backside[e][t];this.distinct_sizes=this.distinct_sizes?.filter((e=>e!==t))},async getProjects(){return await P.get(this.$store.state.publicPath+"/api/categories/").then((t=>t.data)).catch((t=>{W.Z.$emit("noresponse",t)}))},previewMultiImage(t){var e=t.target,i=e.files.length,a=0;if(this.formData.preview=e.files[0],this.preview_list||(this.preview_list=[]),this.formData.image_list||(this.formData.image_list=[]),e.files)while(i--){var o=new FileReader;o.onload=t=>{this.preview_list.push(t.target.result)},this.formData.image_list.push(e.files[a]),o.readAsDataURL(e.files[a]),a++}},reset(){this.formData.image_list=[],this.preview_list=[]},dropFile(t){this.formData.image_list?.splice(t,1),this.preview_list?.splice(t,1)},addNewPost(){W.Z.$emit("addNewPost")},changeP(t){this.formData.category_name=t.target.value;const e=this.projects?.find((e=>e.name===t.target.value))?.description;e&&this.$refs.postTextEditor.pasteHTML($.TU.parse(e?.replaceAll("\r\n\r\n","<span><br/><span/>\r\n\r\n")))},closeModal(){W.Z.$emit("closeModal")},constractFromData(t){if(!this.formData.title||!this.$refs.postTextEditor.getHTML())throw new Error;var e=new FormData;e.append("title",this.formData.title);const i=new M.Z({headingStyle:"atx"});e.append("description",i.turndown(this.$refs.postTextEditor.getHTML())),this.formData.image_list?.forEach((t=>{e.append("images[]",t)})),this.formData.category_name&&e.append("categoryName",this.formData.category_name);const a=[];for(let s in this.options_object)for(let t in this.options_object[s]){const e=this.options_object[s][t];e&&a.push({material:s,size:t,price:e,id:this.formData.options_array?.find((e=>e.material===s&&e.size===t&&!e.is_backside))?.id})}e.append("optionsObject",JSON.stringify(this.options_object)),e.append("optionsArray",JSON.stringify(a));const o=[];for(let s in this.options_object_backside)for(let t in this.options_object_backside[s]){const e=this.options_object_backside[s][t];e&&o.push({material:s,size:t,price:e,id:this.formData.options_array?.find((e=>e.material===s&&e.size===t&&e.is_backside))?.id})}return e.append("optionsObjectBackside",JSON.stringify(this.options_object_backside)),e.append("optionsArrayBackside",JSON.stringify(o)),this.editAll&&e.append("editAll",this.editAll),t&&e.append("id",this.formData.id),e},addNewing(){try{const t=this.constractFromData();P.post(this.$store.state.publicPath+"/api/admin/items",t,{headers:{"Content-Type":"multipart/form-data"}}).then((()=>{W.Z.$emit("postAdded")})).catch((t=>{W.Z.$emit("noresponse",t)}))}catch(t){this.formValid=!0}},editNewing(){try{const t=this.constractFromData(!0);P.put(this.$store.state.publicPath+"/api/admin/items",t,{headers:{"Content-Type":"multipart/form-data"}}).then((()=>{W.Z.$emit("postEdited")})).catch((t=>{W.Z.$emit("noresponse",t)}))}catch(t){console.log(t),this.formValid=!0}}}},U=i(89);const O=(0,U.Z)(V,[["render",D],["__scopeId","data-v-29dd553e"]]);var Z=O;const S=t=>((0,a.dD)("data-v-d9d6c6fc"),t=t(),(0,a.Cn)(),t),H={class:"options-shedle"},F=S((()=>(0,a._)("span",null,"Опции",-1))),A={class:"table"},I=S((()=>(0,a._)("td",null,[(0,a.Uk)("Размер"),(0,a._)("br"),(0,a.Uk)(" Материал")],-1))),N={key:0},x={key:0},T={key:1},E={class:"options-shedle"},Y=S((()=>(0,a._)("span",null,"Обратная сторона",-1))),K={class:"table"},B=S((()=>(0,a._)("td",null,[(0,a.Uk)("Размер"),(0,a._)("br"),(0,a.Uk)(" Материал")],-1))),L={key:0},J={key:0},Q={key:1};function q(t,e,i,o,l,r){const d=(0,a.up)("CButton"),c=(0,a.up)("CModalTitle"),p=(0,a.up)("CModalHeader"),m=(0,a.up)("CFormInput"),h=(0,a.up)("CModalBody"),_=(0,a.up)("CModalFooter"),u=(0,a.up)("CForm"),b=(0,a.up)("CModal");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(d,{class:"mx-3",color:"primary",onClick:r.changePrices},{default:(0,a.w5)((()=>[(0,a.Uk)("Сменить цены")])),_:1},8,["onClick"]),(0,a.Wm)(b,{class:"giant-modal",size:"xl",backdrop:"static",alignment:"center",visible:i.visible,onClose:r.closeModal},{default:(0,a.w5)((()=>[(0,a.Wm)(u,{novalidate:"",validated:l.formValid,ref:"add-file-form",onChange:t.wregert,onSubmit:e[0]||(e[0]=(0,s.iM)((t=>r.editPrices()),["prevent"])),class:"add-user",style:{display:"'none'"}},{default:(0,a.w5)((()=>[(0,a.Wm)(p,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Сменить цены")])),_:1})])),_:1}),(0,a.Wm)(h,null,{default:(0,a.w5)((()=>[(0,a._)("div",H,[F,(0,a._)("table",A,[(0,a._)("thead",null,[(0,a._)("tr",null,[I,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(l.distinct_sizes,(t=>((0,a.wg)(),(0,a.iD)("td",{key:"sizeh-"+t},(0,n.zw)(t),1)))),128))])]),(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(l.distinct_materials,(t=>((0,a.wg)(),(0,a.iD)("tr",{key:"material-"+t},[(0,a._)("td",null,(0,n.zw)(t),1),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(l.distinct_sizes,(e=>((0,a.wg)(),(0,a.iD)("td",{key:"size-"+e},[l.options_object[t][e]?((0,a.wg)(),(0,a.iD)("div",N,[-1===l.edited_array.findIndex((i=>i.material===t&&i.size===e&&!1===i.is_backside))?((0,a.wg)(),(0,a.iD)("div",x,(0,n.zw)(l.options_object[t][e]),1)):((0,a.wg)(),(0,a.iD)("div",T,[(0,a.Wm)(d,{color:"secondary",onClick:i=>r.dropOne(e,t,!1)},{default:(0,a.w5)((()=>[(0,a.Uk)("X")])),_:2},1032,["onClick"])])),(0,a.Wm)(m,{type:"number",onInput:i=>r.editOne(i,e,t,!1)},null,8,["onInput"])])):(0,a.kq)("",!0)])))),128))])))),128))])])]),(0,a._)("div",E,[Y,(0,a._)("table",K,[(0,a._)("thead",null,[(0,a._)("tr",null,[B,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(l.distinct_sizes,(t=>((0,a.wg)(),(0,a.iD)("td",{key:"sizeh-"+t},(0,n.zw)(t),1)))),128))])]),(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(l.distinct_materials,(t=>((0,a.wg)(),(0,a.iD)("tr",{key:"material-"+t},[(0,a._)("td",null,(0,n.zw)(t),1),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(l.distinct_sizes,(e=>((0,a.wg)(),(0,a.iD)("td",{key:"size-"+e},[l.options_object_backside[t][e]?((0,a.wg)(),(0,a.iD)("div",L,[-1===l.edited_array.findIndex((i=>i.material===t&&i.size===e&&!0===i.is_backside))?((0,a.wg)(),(0,a.iD)("div",J,(0,n.zw)(l.options_object_backside[t][e]),1)):((0,a.wg)(),(0,a.iD)("div",Q,[(0,a.Wm)(d,{color:"secondary",onClick:i=>r.dropOne(e,t,!0)},{default:(0,a.w5)((()=>[(0,a.Uk)("X")])),_:2},1032,["onClick"])])),(0,a.Wm)(m,{type:"number",onInput:i=>r.editOne(i,e,t,!0)},null,8,["onInput"])])):(0,a.kq)("",!0)])))),128))])))),128))])])])])),_:1}),(0,a.Wm)(_,null,{default:(0,a.w5)((()=>[(0,a.Wm)(d,{color:"secondary",onClick:r.closeModal},{default:(0,a.w5)((()=>[(0,a.Uk)(" Отменить ")])),_:1},8,["onClick"]),(0,a.Wm)(d,{color:"primary",type:"submit"},{default:(0,a.w5)((()=>[(0,a.Uk)("Редактировать")])),_:1})])),_:1})])),_:1},8,["validated","onChange"])])),_:1},8,["visible","onClose"])],64)}const X=C().create({withCredentials:!0});var G={components:{},props:{visible:Boolean},data(){return{formData:{options_object:{},options_array:[]},formValid:!1,options_object:{},options_object_backside:{},distinct_materials:[],distinct_sizes:[],tempSize:0,tempMaterial:0,edited_array:[]}},async updated(){console.log(1),this.formData={options_array:await this.getPrices()},this.edited_array=[],this.options_object={},this.options_object_backside={},this.formData.options_array=this.formData.options_array?.filter((({material:t,price:e,size:i})=>!!(t||i||e)))?.map((t=>(t.price=`${t.min_price}-${t.max_price}`,t))),this.distinct_materials=[...new Set(this.formData.options_array?.map((({material:t})=>t)))],this.distinct_sizes=[...new Set(this.formData.options_array?.map((({size:t})=>t)))];for(let{size:t,material:e,price:i,is_backside:a}of this.formData.options_array)a?(this.options_object_backside[e]?this.options_object_backside[e][t]=i:this.options_object_backside[e]={[t]:i},this.options_object[e]?this.options_object[e][t]=this.options_object[e][t]??null:this.options_object[e]={[t]:null}):(this.options_object[e]?this.options_object[e][t]=i:this.options_object[e]={[t]:i},this.options_object_backside[e]?this.options_object_backside[e][t]=this.options_object_backside[e][t]??null:this.options_object_backside[e]={[t]:null});console.log(this.options_object,this.options_object_backside)},async mounted(){},methods:{async getPrices(){return X.get(this.$store.state.publicPath+"/api/admin/prices/",{params:{}}).then((t=>t.data)).catch((t=>(W.Z.$emit("noresponse",t),!1)))},editOne(t,e,i,a){const o=parseInt(t.target.value);if(!o)return this.dropOne(e,i,a);const s=this.edited_array.findIndex((t=>t.material===i&&t.size===e&&t.is_backside===a));-1!==s?this.edited_array[s].price=o:this.edited_array.push({size:e,material:i,is_backside:a,price:o}),console.log(this.edited_array)},dropOne(t,e,i){this.edited_array=this.edited_array.filter((a=>!(a.size===t&&a.material===e&&a.is_backside===i))),console.log(this.edited_array)},changePrices(){W.Z.$emit("changePrices")},changeP(t){this.formData.category_name=t.target.value},closeModal(){W.Z.$emit("closePrices")},constractFromData(){var t=new FormData;return t.append("edited_array",JSON.stringify(this.edited_array)),t},editPrices(){try{const t=this.constractFromData(!0);X.put(this.$store.state.publicPath+"/api/admin/prices",t,{headers:{"Content-Type":"multipart/form-data"}}).then((()=>{W.Z.$emit("closePrices")})).catch((t=>{W.Z.$emit("noresponse",t)}))}catch(t){console.log(t),this.formValid=!0}}}};const R=(0,U.Z)(G,[["render",q],["__scopeId","data-v-d9d6c6fc"]]);var tt=R,et=i(7942);const it=C().create({withCredentials:!0,credentials:"include"});var at={components:{AddItemModal:Z,Table:et.Z,ChangePricesModal:tt},props:["tag","project"],data(){return{myApi:it,formVisible:!1,changePricesVisible:!1,formData:{},rows:[],searchQuery:null,dataActions:{"Дублировать":{action:this.duble,color:"primary"},"Изменить":{action:this.change,color:"warning"},"Удалить":{action:this.delete,color:"danger"},"▲":{action:this.putHigrer,color:"secondary"},"▼":{action:this.putLower,color:"secondary"}},tableFieldNames:[{name:"title",title:"Название"},{name:"description",title:"Описание"},{name:"publication_date",title:"Дата добавления"}]}},created(){W.Z.$on("addNewPost",(()=>{this.formMode="new",this.formData={category:this.$route.params.categoryName},this.formVisible=!0})),W.Z.$on("changePrices",(()=>{this.changePricesVisible=!0})),W.Z.$on("closePrices",(()=>{this.changePricesVisible=!1})),W.Z.$on("closeModal",(()=>{this.formVisible=!1,this.formData={}})),W.Z.$on("postAdded",(()=>{this.formVisible=!1,this.get(),this.formData={}})),W.Z.$on("postEdited",(()=>{this.formVisible=!1,this.get(),this.formData={}}))},methods:{change(t){this.formVisible=!0,t.tags_array=new Set(t.tags_array),this.formData=t,console.log(t),this.formMode="edit"},constractFromData(t){var e=new FormData;e.append("title",t.title),e.append("description",t.description),t.image_list?.forEach((t=>{e.append("images[]",t)})),t.category_name&&e.append("categoryName",t.category_name);const i={},a={};t.options_array=t.options_array?.filter((({material:t,price:e,size:i})=>!!(t||i||e)));for(let{size:o,material:s,price:n,is_backside:l}of t.options_array)l?(a[s]?a[s][o]=n:a[s]={[o]:n},i[s]?i[s][o]=i[s][o]??null:i[s]={[o]:null}):(i[s]?i[s][o]=n:i[s]={[o]:n},a[s]?a[s][o]=a[s][o]??null:a[s]={[o]:null});return e.append("optionsObject",JSON.stringify(i)),e.append("optionsObjectBackside",JSON.stringify(a)),e},duble(t){try{const e=this.constractFromData(t);it.post(this.$store.state.publicPath+"/api/admin/items",e,{headers:{"Content-Type":"multipart/form-data"}}).then((()=>{W.Z.$emit("postAdded")})).catch((t=>{W.Z.$emit("noresponse",t)}))}catch(e){this.formValid=!0}},putHigrer(t,e="up"){return it.put(this.$store.state.publicPath+"/api/admin/items/",{order_id:t.order_id,id:t.id,type:e}).then((()=>{this.get(),W.Z.$emit("projectDeleted")})).catch((t=>{W.Z.$emit("noresponse",t)}))},putLower(t){this.putHigrer(t,"down")},search(t){this.searchQuery=t.target.value,this.get()},get(t,e){return console.log(this.tag),it.get(this.$store.state.publicPath+"/api/admin/items/",{params:{take:t??10,page:e??1,tagsArray:this.$route.params.tag?[this.$route.params.tag]:void 0,category:this.$route.params.categoryName,searchQuery:this.searchQuery}}).then((t=>((t.data?.length>0||this.searchQuery&&1===(e??1))&&(this.rows=t.data),t.data))).catch((t=>(W.Z.$emit("noresponse",t),!1)))},delete(t){const e=confirm("Вы действительно хотите удалить позицию из каталога?");if(e)return it.delete(this.$store.state.publicPath+"/api/admin/items/",{data:{id:t.id}}).then((()=>{this.get(),W.Z.$emit("postDeleted")})).catch((t=>{W.Z.$emit("noresponse",t)}))}}};const ot=(0,U.Z)(at,[["render",o]]);var st=ot}}]);
//# sourceMappingURL=56.842bb956.js.map