"use strict";(self["webpackChunk_coreui_coreui_free_vue_admin_template"]=self["webpackChunk_coreui_coreui_free_vue_admin_template"]||[]).push([[91],{8091:function(t,e,i){i.r(e),i.d(e,{default:function(){return ot}});var a=i(3396);function o(t,e,i,o,s,n){const r=(0,a.up)("AddItemModal"),l=(0,a.up)("ChangePricesModal"),d=(0,a.up)("CFormInput"),c=(0,a.up)("Table");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a.Wm)(r,{visible:s.formVisible,formData:s.formData,mode:t.formMode},null,8,["visible","formData","mode"]),(0,a.Wm)(l,{visible:s.changePricesVisible},null,8,["visible"]),(0,a.Wm)(d,{class:"mb-4",type:"text",onInput:n.search,placeholder:"Поиск по названию"},null,8,["onInput"]),(0,a.Wm)(c,{fields:s.tableFieldNames,postData:n.get,actions:s.dataActions,rows:s.rows,editMode:"form",name:"Позиции"},null,8,["fields","postData","actions","rows"])])}var s=i(9242),n=i(7139);const r=t=>((0,a.dD)("data-v-6e377ede"),t=t(),(0,a.Cn)(),t),l={class:"projects-list"},d=r((()=>(0,a._)("span",null,"Категория",-1))),c={class:"options-shedle"},p=r((()=>(0,a._)("span",null,"Опции",-1))),m={class:"table"},_=r((()=>(0,a._)("td",null,[(0,a.Uk)("Размер"),(0,a._)("br"),(0,a.Uk)(" Материал")],-1))),h=r((()=>(0,a._)("td",null,null,-1))),u={class:"options-shedle"},b=r((()=>(0,a._)("span",null,"Обратная сторона",-1))),f={class:"table"},g=r((()=>(0,a._)("td",null,[(0,a.Uk)("Размер"),(0,a._)("br"),(0,a.Uk)(" Материал")],-1))),y={class:"border p-2 mt-3 preview-container"},w=["src"],k=["onClick"];function j(t,e,i,o,r,j){const D=(0,a.up)("CButton"),v=(0,a.up)("CModalTitle"),C=(0,a.up)("CModalHeader"),z=(0,a.up)("CFormInput"),M=(0,a.up)("CFormCheck"),$=(0,a.up)("CInputGroup"),W=(0,a.up)("QuillEditor"),P=(0,a.up)("CModalBody"),V=(0,a.up)("CModalFooter"),U=(0,a.up)("CForm"),O=(0,a.up)("CModal");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(D,{color:"primary",onClick:j.addNewPost},{default:(0,a.w5)((()=>[(0,a.Uk)("Добавить товар")])),_:1},8,["onClick"]),(0,a.Wm)(O,{size:"xl",backdrop:"static",alignment:"center",visible:i.visible,onClose:j.closeModal},{default:(0,a.w5)((()=>[(0,a.Wm)(U,{novalidate:"",validated:r.formValid,ref:"add-file-form",onChange:t.wregert,onSubmit:e[5]||(e[5]=(0,s.iM)((t=>"new"===i.mode?j.addNewing():j.editNewing()),["prevent"])),class:"add-user",style:{display:"'none'"}},{default:(0,a.w5)((()=>[(0,a.Wm)(C,null,{default:(0,a.w5)((()=>[(0,a.Wm)(v,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)("new"===i.mode?"Добавить товар":"Редактировать товар"),1)])),_:1})])),_:1}),(0,a.Wm)(P,null,{default:(0,a.w5)((()=>[(0,a.Wm)(z,{class:"mb-3",modelValue:i.formData.title,"onUpdate:modelValue":e[0]||(e[0]=t=>i.formData.title=t),placeholder:"Заголовок",id:"inputHeader","aria-describedby":"inputGroupPrepend",feedbackValid:"Все ок",feedbackInvalid:"Введите корректный заголовок",required:""},null,8,["modelValue"]),(0,a._)("div",l,[d,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.projects,(t=>((0,a.wg)(),(0,a.j4)(M,{key:t.name,id:t.name,checked:t.name===i.formData.category_name,onChange:j.changeP,type:"radio",name:"project-name",value:t.name,label:t.name},null,8,["id","checked","onChange","value","label"])))),128)),(0,a.Wm)(M,{id:"null-name",checked:!i.formData.category_name,onChange:j.changeP,type:"radio",name:"project-name",value:"",label:"Без категорий"},null,8,["checked","onChange"])]),(0,a._)("div",c,[p,(0,a._)("table",m,[(0,a._)("thead",null,[(0,a._)("tr",null,[_,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.distinct_sizes,(t=>((0,a.wg)(),(0,a.iD)("td",{key:"sizeh-"+t},[(0,a.Uk)((0,n.zw)(t)+" ",1),(0,a.Wm)(D,{color:"secondary",onClick:e=>j.dropSize(t)},{default:(0,a.w5)((()=>[(0,a.Uk)("X")])),_:2},1032,["onClick"])])))),128)),(0,a._)("td",null,[(0,a.Wm)($,{class:""},{default:(0,a.w5)((()=>[(0,a.Wm)(z,{placeholder:"Новый размер",type:"text",modelValue:r.tempSize,"onUpdate:modelValue":e[1]||(e[1]=t=>r.tempSize=t)},null,8,["modelValue"]),(0,a.Wm)(D,{class:"add-button",type:"button",color:"secondary",onClick:e[2]||(e[2]=t=>j.addSize(r.tempSize)),variant:"outline"},{default:(0,a.w5)((()=>[(0,a.Uk)("Добавить")])),_:1})])),_:1})])])]),(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.distinct_materials,(t=>((0,a.wg)(),(0,a.iD)("tr",{key:"material-"+t},[(0,a._)("td",null,[(0,a.Uk)((0,n.zw)(t)+" ",1),(0,a.Wm)(D,{color:"secondary",onClick:e=>j.dropMaterial(t)},{default:(0,a.w5)((()=>[(0,a.Uk)("X")])),_:2},1032,["onClick"])]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.distinct_sizes,(e=>((0,a.wg)(),(0,a.iD)("td",{key:"size-"+e},[(0,a.Wm)(z,{type:"number",modelValue:r.options_object[t][e],"onUpdate:modelValue":i=>r.options_object[t][e]=i,modelModifiers:{number:!0}},null,8,["modelValue","onUpdate:modelValue"])])))),128)),h])))),128)),(0,a._)("tr",null,[(0,a._)("td",null,[(0,a.Wm)($,{class:""},{default:(0,a.w5)((()=>[(0,a.Wm)(z,{placeholder:"Новый материал",type:"text",modelValue:r.tempMaterial,"onUpdate:modelValue":e[3]||(e[3]=t=>r.tempMaterial=t)},null,8,["modelValue"]),(0,a.Wm)(D,{class:"add-button",type:"button",color:"secondary",onClick:e[4]||(e[4]=t=>j.addMaterial(r.tempMaterial)),variant:"outline"},{default:(0,a.w5)((()=>[(0,a.Uk)("Добавить ")])),_:1})])),_:1})])])])])]),(0,a._)("div",u,[b,(0,a._)("table",f,[(0,a._)("thead",null,[(0,a._)("tr",null,[g,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.distinct_sizes,(t=>((0,a.wg)(),(0,a.iD)("td",{key:"sizeh-"+t},(0,n.zw)(t),1)))),128))])]),(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.distinct_materials,(t=>((0,a.wg)(),(0,a.iD)("tr",{key:"material-"+t},[(0,a._)("td",null,(0,n.zw)(t),1),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.distinct_sizes,(e=>((0,a.wg)(),(0,a.iD)("td",{key:"size-"+e},[(0,a.Wm)(z,{type:"number",modelValue:r.options_object_backside[t][e],"onUpdate:modelValue":i=>r.options_object_backside[t][e]=i,modelModifiers:{number:!0}},null,8,["modelValue","onUpdate:modelValue"])])))),128))])))),128))])])]),(0,a.Wm)(z,{type:"file",accept:"image/*",multiple:"multiple",ref:"file",onChange:j.previewMultiImage,class:"mb-3",label:"Превью",placeholder:"Превью"},null,8,["onChange"]),(0,a._)("div",y,[r.preview_list?.length?((0,a.wg)(!0),(0,a.iD)(a.HY,{key:0},(0,a.Ko)(r.preview_list,((t,e)=>((0,a.wg)(),(0,a.iD)("div",{key:e},[(0,a._)("img",{src:t,class:"img-fluid"},null,8,w),(0,a._)("button",{onClick:(0,s.iM)((t=>j.dropFile(e)),["prevent"])},"Х",8,k)])))),128)):(0,a.kq)("",!0)]),(0,a.Wm)(W,{theme:"snow",toolbar:"essential",ref:"postTextEditor",id:"postTextEditor",placeholder:"Краткое описание"},null,512)])),_:1}),(0,a.Wm)(V,null,{default:(0,a.w5)((()=>[(0,a.Wm)(D,{color:"secondary",onClick:j.closeModal},{default:(0,a.w5)((()=>[(0,a.Uk)(" Отменить ")])),_:1},8,["onClick"]),(0,a.wy)((0,a.Wm)(D,{color:"primary",type:"submit"},{default:(0,a.w5)((()=>[(0,a.Uk)("Добавить")])),_:1},512),[[s.F8,"new"===i.mode]]),(0,a.wy)((0,a.Wm)(D,{color:"primary",type:"submit"},{default:(0,a.w5)((()=>[(0,a.Uk)("Редактировать")])),_:1},512),[[s.F8,"edit"===i.mode]])])),_:1})])),_:1},8,["validated","onChange"])])),_:1},8,["visible","onClose"])],64)}i(7658);var D=i(6265),v=i.n(D),C=i(6149),z=i(2777),M=i(5068),$=i(7123);const W=v().create({withCredentials:!0});var P={components:{QuillEditor:C.Bn},props:{mode:{required:!0,type:String,validator:t=>["new","edit"].includes(t.toLowerCase())},visible:!1,formData:{title:"",text:"",description:"",preview:"",category_name:"",image_list:[],tags_array:new Set,options_object:{},options_array:[]}},data(){return{textMd2:"",textEditMode:"md2",formValid:!1,preview_list:[],options_object:{},options_object_backside:{},distinct_materials:[],distinct_sizes:[],tempSize:0,tempMaterial:0}},updated(){console.log(1),this.options_object={},this.options_object_backside={},this.formData.options_array=this.formData.options_array?.filter((({material:t,price:e,size:i})=>!!(t||i||e))),this.distinct_materials=[...new Set(this.formData.options_array?.map((({material:t})=>t)))],this.distinct_sizes=[...new Set(this.formData.options_array?.map((({size:t})=>t)))],this.formData.description&&this.$refs.postTextEditor.pasteHTML(M.TU.parse(this.formData.description?.replaceAll("\r\n\r\n","<span><br/><span/>\r\n\r\n")));for(let{size:t,material:e,price:i,is_backside:a}of this.formData.options_array)a?(this.options_object_backside[e]?this.options_object_backside[e][t]=i:this.options_object_backside[e]={[t]:i},this.options_object[e]?this.options_object[e][t]=this.options_object[e][t]??null:this.options_object[e]={[t]:null}):(this.options_object[e]?this.options_object[e][t]=i:this.options_object[e]={[t]:i},this.options_object_backside[e]?this.options_object_backside[e][t]=this.options_object_backside[e][t]??null:this.options_object_backside[e]={[t]:null});console.log(this.options_object,this.options_object_backside),this.preview_list=this.formData.image_list?.filter((t=>t))?.map((t=>`${this.$store.state.serverAddr}/pics/${t}`)),document.getElementsByClassName("ql-toolbar")?.[0]?.classList.add("hidden")},async mounted(){this.projects=await this.getProjects(),console.log(this.tags,this.projects)},methods:{addMaterial(t){let e=Object.values(this.options_object)?.[0]??{};e=Object.fromEntries(Object.entries(e)?.map((([t])=>[t,0]))),this.options_object[t]=e,e=Object.values(this.options_object_backside)?.[0]??{},e=Object.fromEntries(Object.entries(e)?.map((([t])=>[t,0]))),this.options_object_backside[t]=e,this.distinct_materials.push(t),this.tempMaterial=""},addSize(t){const e=Object.entries(this.options_object)?.map((([e,i])=>[e,Object.assign(i??{},{[t]:0})]));this.options_object=Object.fromEntries(e);const i=Object.entries(this.options_object_backside)?.map((([e,i])=>[e,Object.assign(i??{},{[t]:0})]));this.options_object_backside=Object.fromEntries(i),this.tempSize="",this.distinct_sizes.push(t)},dropMaterial(t){delete this.options_object[t],delete this.options_object_backside[t],this.distinct_materials=this.distinct_materials?.filter((e=>e!==t))},dropSize(t){for(let e in this.options_object)delete this.options_object[e][t],delete this.options_object_backside[e][t];this.distinct_sizes=this.distinct_sizes?.filter((e=>e!==t))},async getProjects(){return await W.get(this.$store.state.publicPath+"/api/categories/").then((t=>t.data)).catch((t=>{$.Z.$emit("noresponse",t)}))},previewMultiImage(t){var e=t.target,i=e.files.length,a=0;if(this.formData.preview=e.files[0],this.preview_list||(this.preview_list=[]),this.formData.image_list||(this.formData.image_list=[]),e.files)while(i--){var o=new FileReader;o.onload=t=>{this.preview_list.push(t.target.result)},this.formData.image_list.push(e.files[a]),o.readAsDataURL(e.files[a]),a++}},reset(){this.formData.image_list=[],this.preview_list=[]},dropFile(t){this.formData.image_list?.splice(t,1),this.preview_list?.splice(t,1)},addNewPost(){$.Z.$emit("addNewPost")},changeP(t){this.formData.category_name=t.target.value;const e=this.projects?.find((e=>e.name===t.target.value))?.description;e&&this.$refs.postTextEditor.pasteHTML(M.TU.parse(e?.replaceAll("\r\n\r\n","<span><br/><span/>\r\n\r\n")))},closeModal(){$.Z.$emit("closeModal")},constractFromData(t){if(!this.formData.title||!this.$refs.postTextEditor.getHTML())throw new Error;var e=new FormData;e.append("title",this.formData.title);const i=new z.Z({headingStyle:"atx"});e.append("description",i.turndown(this.$refs.postTextEditor.getHTML())),this.formData.image_list?.forEach((t=>{e.append("images[]",t)})),this.formData.category_name&&e.append("categoryName",this.formData.category_name);const a=[];for(let s in this.options_object)for(let t in this.options_object[s]){const e=this.options_object[s][t];e&&a.push({material:s,size:t,price:e,id:this.formData.options_array?.find((e=>e.material===s&&e.size===t&&!e.is_backside))?.id})}e.append("optionsObject",JSON.stringify(this.options_object)),e.append("optionsArray",JSON.stringify(a));const o=[];for(let s in this.options_object_backside)for(let t in this.options_object_backside[s]){const e=this.options_object_backside[s][t];e&&o.push({material:s,size:t,price:e,id:this.formData.options_array?.find((e=>e.material===s&&e.size===t&&e.is_backside))?.id})}return e.append("optionsObjectBackside",JSON.stringify(this.options_object_backside)),e.append("optionsArrayBackside",JSON.stringify(o)),t&&e.append("id",this.formData.id),e},addNewing(){try{const t=this.constractFromData();W.post(this.$store.state.publicPath+"/api/admin/items",t,{headers:{"Content-Type":"multipart/form-data"}}).then((()=>{$.Z.$emit("postAdded")})).catch((t=>{$.Z.$emit("noresponse",t)}))}catch(t){this.formValid=!0}},editNewing(){try{const t=this.constractFromData(!0);W.put(this.$store.state.publicPath+"/api/admin/items",t,{headers:{"Content-Type":"multipart/form-data"}}).then((()=>{$.Z.$emit("postEdited")})).catch((t=>{$.Z.$emit("noresponse",t)}))}catch(t){console.log(t),this.formValid=!0}}}},V=i(89);const U=(0,V.Z)(P,[["render",j],["__scopeId","data-v-6e377ede"]]);var O=U;const Z=t=>((0,a.dD)("data-v-3e118a8e"),t=t(),(0,a.Cn)(),t),S={class:"options-shedle"},H=Z((()=>(0,a._)("span",null,"Опции",-1))),F={class:"table"},N=Z((()=>(0,a._)("td",null,[(0,a.Uk)("Размер"),(0,a._)("br"),(0,a.Uk)(" Материал")],-1))),I={key:0},x={key:0},T={key:1},E={class:"options-shedle"},Y=Z((()=>(0,a._)("span",null,"Обратная сторона",-1))),A={class:"table"},K=Z((()=>(0,a._)("td",null,[(0,a.Uk)("Размер"),(0,a._)("br"),(0,a.Uk)(" Материал")],-1))),B={key:0},L={key:0},J={key:1};function Q(t,e,i,o,r,l){const d=(0,a.up)("CButton"),c=(0,a.up)("CModalTitle"),p=(0,a.up)("CModalHeader"),m=(0,a.up)("CFormInput"),_=(0,a.up)("CModalBody"),h=(0,a.up)("CModalFooter"),u=(0,a.up)("CForm"),b=(0,a.up)("CModal");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(d,{class:"mx-3",color:"primary",onClick:l.changePrices},{default:(0,a.w5)((()=>[(0,a.Uk)("Сменить цены")])),_:1},8,["onClick"]),(0,a.Wm)(b,{class:"giant-modal",size:"xl",backdrop:"static",alignment:"center",visible:i.visible,onClose:l.closeModal},{default:(0,a.w5)((()=>[(0,a.Wm)(u,{novalidate:"",validated:r.formValid,ref:"add-file-form",onChange:t.wregert,onSubmit:e[0]||(e[0]=(0,s.iM)((t=>l.editPrices()),["prevent"])),class:"add-user",style:{display:"'none'"}},{default:(0,a.w5)((()=>[(0,a.Wm)(p,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Сменить цены")])),_:1})])),_:1}),(0,a.Wm)(_,null,{default:(0,a.w5)((()=>[(0,a._)("div",S,[H,(0,a._)("table",F,[(0,a._)("thead",null,[(0,a._)("tr",null,[N,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.distinct_sizes,(t=>((0,a.wg)(),(0,a.iD)("td",{key:"sizeh-"+t},(0,n.zw)(t),1)))),128))])]),(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.distinct_materials,(t=>((0,a.wg)(),(0,a.iD)("tr",{key:"material-"+t},[(0,a._)("td",null,(0,n.zw)(t),1),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.distinct_sizes,(e=>((0,a.wg)(),(0,a.iD)("td",{key:"size-"+e},[r.options_object[t][e]?((0,a.wg)(),(0,a.iD)("div",I,[-1===r.edited_array.findIndex((i=>i.material===t&&i.size===e&&!1===i.is_backside))?((0,a.wg)(),(0,a.iD)("div",x,(0,n.zw)(r.options_object[t][e]),1)):((0,a.wg)(),(0,a.iD)("div",T,[(0,a.Wm)(d,{color:"secondary",onClick:i=>l.dropOne(e,t,!1)},{default:(0,a.w5)((()=>[(0,a.Uk)("X")])),_:2},1032,["onClick"])])),(0,a.Wm)(m,{type:"number",onInput:i=>l.editOne(i,e,t,!1)},null,8,["onInput"])])):(0,a.kq)("",!0)])))),128))])))),128))])])]),(0,a._)("div",E,[Y,(0,a._)("table",A,[(0,a._)("thead",null,[(0,a._)("tr",null,[K,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.distinct_sizes,(t=>((0,a.wg)(),(0,a.iD)("td",{key:"sizeh-"+t},(0,n.zw)(t),1)))),128))])]),(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.distinct_materials,(t=>((0,a.wg)(),(0,a.iD)("tr",{key:"material-"+t},[(0,a._)("td",null,(0,n.zw)(t),1),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.distinct_sizes,(e=>((0,a.wg)(),(0,a.iD)("td",{key:"size-"+e},[r.options_object_backside[t][e]?((0,a.wg)(),(0,a.iD)("div",B,[-1===r.edited_array.findIndex((i=>i.material===t&&i.size===e&&!0===i.is_backside))?((0,a.wg)(),(0,a.iD)("div",L,(0,n.zw)(r.options_object_backside[t][e]),1)):((0,a.wg)(),(0,a.iD)("div",J,[(0,a.Wm)(d,{color:"secondary",onClick:i=>l.dropOne(e,t,!0)},{default:(0,a.w5)((()=>[(0,a.Uk)("X")])),_:2},1032,["onClick"])])),(0,a.Wm)(m,{type:"number",onInput:i=>l.editOne(i,e,t,!0)},null,8,["onInput"])])):(0,a.kq)("",!0)])))),128))])))),128))])])])])),_:1}),(0,a.Wm)(h,null,{default:(0,a.w5)((()=>[(0,a.Wm)(d,{color:"secondary",onClick:l.closeModal},{default:(0,a.w5)((()=>[(0,a.Uk)(" Отменить ")])),_:1},8,["onClick"]),(0,a.Wm)(d,{color:"primary",type:"submit"},{default:(0,a.w5)((()=>[(0,a.Uk)("Редактировать")])),_:1})])),_:1})])),_:1},8,["validated","onChange"])])),_:1},8,["visible","onClose"])],64)}const q=v().create({withCredentials:!0});var X={components:{},props:{visible:Boolean},data(){return{formData:{options_object:{},options_array:[]},formValid:!1,options_object:{},options_object_backside:{},distinct_materials:[],distinct_sizes:[],tempSize:0,tempMaterial:0,edited_array:[]}},async updated(){console.log(1),this.formData={options_array:await this.getPrices()},this.edited_array=[],this.options_object={},this.options_object_backside={},this.formData.options_array=this.formData.options_array?.filter((({material:t,price:e,size:i})=>!!(t||i||e)))?.map((t=>(t.price=`${t.min_price}-${t.max_price}`,t))),this.distinct_materials=[...new Set(this.formData.options_array?.map((({material:t})=>t)))],this.distinct_sizes=[...new Set(this.formData.options_array?.map((({size:t})=>t)))];for(let{size:t,material:e,price:i,is_backside:a}of this.formData.options_array)a?(this.options_object_backside[e]?this.options_object_backside[e][t]=i:this.options_object_backside[e]={[t]:i},this.options_object[e]?this.options_object[e][t]=this.options_object[e][t]??null:this.options_object[e]={[t]:null}):(this.options_object[e]?this.options_object[e][t]=i:this.options_object[e]={[t]:i},this.options_object_backside[e]?this.options_object_backside[e][t]=this.options_object_backside[e][t]??null:this.options_object_backside[e]={[t]:null});console.log(this.options_object,this.options_object_backside)},async mounted(){},methods:{async getPrices(){return q.get(this.$store.state.publicPath+"/api/admin/prices/",{params:{}}).then((t=>t.data)).catch((t=>($.Z.$emit("noresponse",t),!1)))},editOne(t,e,i,a){const o=parseInt(t.target.value);if(!o)return this.dropOne(e,i,a);const s=this.edited_array.findIndex((t=>t.material===i&&t.size===e&&t.is_backside===a));-1!==s?this.edited_array[s].price=o:this.edited_array.push({size:e,material:i,is_backside:a,price:o}),console.log(this.edited_array)},dropOne(t,e,i){this.edited_array=this.edited_array.filter((a=>!(a.size===t&&a.material===e&&a.is_backside===i))),console.log(this.edited_array)},changePrices(){$.Z.$emit("changePrices")},changeP(t){this.formData.category_name=t.target.value},closeModal(){$.Z.$emit("closePrices")},constractFromData(){var t=new FormData;return t.append("edited_array",JSON.stringify(this.edited_array)),t},editPrices(){try{const t=this.constractFromData(!0);q.put(this.$store.state.publicPath+"/api/admin/prices",t,{headers:{"Content-Type":"multipart/form-data"}}).then((()=>{$.Z.$emit("closePrices")})).catch((t=>{$.Z.$emit("noresponse",t)}))}catch(t){console.log(t),this.formValid=!0}}}};const G=(0,V.Z)(X,[["render",Q],["__scopeId","data-v-3e118a8e"]]);var R=G,tt=i(7942);const et=v().create({withCredentials:!0,credentials:"include"});var it={components:{AddItemModal:O,Table:tt.Z,ChangePricesModal:R},props:["tag","project"],data(){return{myApi:et,formVisible:!1,changePricesVisible:!1,formData:{},rows:[],searchQuery:null,dataActions:{"Дублировать":{action:this.duble,color:"primary"},"Изменить":{action:this.change,color:"warning"},"Удалить":{action:this.delete,color:"danger"},"▲":{action:this.putHigrer,color:"secondary"},"▼":{action:this.putLower,color:"secondary"}},tableFieldNames:[{name:"title",title:"Название"},{name:"description",title:"Описание"},{name:"publication_date",title:"Дата добавления"}]}},created(){$.Z.$on("addNewPost",(()=>{this.formMode="new",this.formData={category:this.$route.params.categoryName},this.formVisible=!0})),$.Z.$on("changePrices",(()=>{this.changePricesVisible=!0})),$.Z.$on("closePrices",(()=>{this.changePricesVisible=!1})),$.Z.$on("closeModal",(()=>{this.formVisible=!1,this.formData={}})),$.Z.$on("postAdded",(()=>{this.formVisible=!1,this.get(),this.formData={}})),$.Z.$on("postEdited",(()=>{this.formVisible=!1,this.get(),this.formData={}}))},methods:{change(t){this.formVisible=!0,t.tags_array=new Set(t.tags_array),this.formData=t,console.log(t),this.formMode="edit"},constractFromData(t){var e=new FormData;e.append("title",t.title),e.append("description",t.description),t.image_list?.forEach((t=>{e.append("images[]",t)})),t.category_name&&e.append("categoryName",t.category_name);const i={},a={};t.options_array=t.options_array?.filter((({material:t,price:e,size:i})=>!!(t||i||e)));for(let{size:o,material:s,price:n,is_backside:r}of t.options_array)r?(a[s]?a[s][o]=n:a[s]={[o]:n},i[s]?i[s][o]=i[s][o]??null:i[s]={[o]:null}):(i[s]?i[s][o]=n:i[s]={[o]:n},a[s]?a[s][o]=a[s][o]??null:a[s]={[o]:null});return e.append("optionsObject",JSON.stringify(i)),e.append("optionsObjectBackside",JSON.stringify(a)),e},duble(t){try{const e=this.constractFromData(t);et.post(this.$store.state.publicPath+"/api/admin/items",e,{headers:{"Content-Type":"multipart/form-data"}}).then((()=>{$.Z.$emit("postAdded")})).catch((t=>{$.Z.$emit("noresponse",t)}))}catch(e){this.formValid=!0}},putHigrer(t,e="up"){return et.put(this.$store.state.publicPath+"/api/admin/items/",{order_id:t.order_id,id:t.id,type:e}).then((()=>{this.get(),$.Z.$emit("projectDeleted")})).catch((t=>{$.Z.$emit("noresponse",t)}))},putLower(t){this.putHigrer(t,"down")},search(t){this.searchQuery=t.target.value,this.get()},get(t,e){return console.log(this.tag),et.get(this.$store.state.publicPath+"/api/admin/items/",{params:{take:t??10,page:e??1,tagsArray:this.$route.params.tag?[this.$route.params.tag]:void 0,category:this.$route.params.categoryName,searchQuery:this.searchQuery}}).then((t=>((t.data?.length>0||this.searchQuery&&1===(e??1))&&(this.rows=t.data),t.data))).catch((t=>($.Z.$emit("noresponse",t),!1)))},delete(t){const e=confirm("Вы действительно хотите удалить позицию из каталога?");if(e)return et.delete(this.$store.state.publicPath+"/api/admin/items/",{data:{id:t.id}}).then((()=>{this.get(),$.Z.$emit("postDeleted")})).catch((t=>{$.Z.$emit("noresponse",t)}))}}};const at=(0,V.Z)(it,[["render",o]]);var ot=at}}]);
//# sourceMappingURL=91.5dc0b0d1.js.map