"use strict";(self["webpackChunk_coreui_coreui_free_vue_admin_template"]=self["webpackChunk_coreui_coreui_free_vue_admin_template"]||[]).push([[532],{7552:function(e,t,s){s.d(t,{Z:function(){return h}});var i=s(3396);const r={class:"search-block"},a=["value"];function n(e,t,s,n,o,c){return(0,i.wg)(),(0,i.iD)("div",r,[(0,i._)("input",{type:"search",value:e.$store.state.searchQuery,onInput:t[0]||(t[0]=(...e)=>c.search&&c.search(...e)),onChange:t[1]||(t[1]=(...e)=>c.openResults&&c.openResults(...e)),placeholder:"Поиск.."},null,40,a)])}s(7658);var o={data(){return{}},mounted(){},methods:{search(e){this.$store.state.searchQuery=e.target.value},openResults(e){"Filters"===this.$route.name&&this.$router.push("/results")}}},c=s(89);const l=(0,c.Z)(o,[["render",n]]);var h=l},532:function(e,t,s){s.r(t),s.d(t,{default:function(){return d}});var i=s(3396),r=s(7139);const a=(0,i._)("h1",null,"Каталог",-1),n={class:"results-block"},o=["src"];function c(e,t,s,c,l,h){const u=(0,i.up)("searchBlock"),m=(0,i.up)("router-link");return(0,i.wg)(),(0,i.iD)(i.HY,null,[a,(0,i.Wm)(u),(0,i._)("div",n,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(this.$store.state.results,(e=>((0,i.wg)(),(0,i.iD)("div",{class:"result-item",key:e.id},[(0,i.Wm)(m,{to:`/items/${e.id}`},{default:(0,i.w5)((()=>[(0,i._)("img",{src:e.img},null,8,o),(0,i._)("h2",null,(0,r.zw)(e.name),1)])),_:2},1032,["to"])])))),128))])],64)}var l=s(7552),h=s(7123),u={components:{searchBlock:l.Z},data(){return{page:1,perPage:10,results:[{id:1,title:"Объект 1",link:"https://google.com",img:""}]}},watch:{"$store.state.searchQuery":function(){this.sendSearchRequest()}},async mounted(){this.scroll(),window.Telegram.WebApp.MainButton.disable(),console.log(this.$route.params);const e=this.$route.params?.page,t=this.$route.params?.filter;this.city=this.$route.params?.city,"2"===e?this.property_class=t:"3"===e?this.commissioning_year=t:"1"===e?(this.sale_percent_min=this.$store.state.filters.find((t=>e==t.id))?.values.find((e=>e.max==t))?.min,this.sale_percent_max=t):"4"===e&&(this.meter_price_min=this.$store.state.filters.find((t=>e==t.id))?.values.find((e=>e.max==t))?.min,this.meter_price_max=t),this.results=await this.sendSearchRequest()},methods:{scroll(){window.onscroll=async()=>{let e=window.scrollY+window.innerHeight+1e3>document.documentElement.scrollHeight;if(e&&!this.loadingUpdate&&!this.isEnded){this.loadingUpdate=!0;const e=await this.sendSearchRequest();this.news=[...this.news,...e]}}},async sendSearchRequest(){return await this.$store.state.myApi.get(this.$store.state.restAddr+"/items",{params:{property_class:this.property_class,sale_percent_min:this.sale_percent_min,sale_percent_max:this.sale_percent_max,commissioning_year:this.commissioning_year,meter_price_min:this.meter_price_min,meter_price_max:this.meter_price_max,searchQuery:this.$store.state.searchQuery,city:this.city,take:10,page:this.page??1}}).then((e=>{const t=e.data;return t.length<this.perPage?this.isEnded=!0:this.page++,this.loadingUpdate=!1,console.log(t),t})).catch((e=>{h.Z.$emit("noresponse",e)}))}}},m=s(89);const p=(0,m.Z)(u,[["render",c]]);var d=p}}]);
//# sourceMappingURL=532.c443784e.js.map